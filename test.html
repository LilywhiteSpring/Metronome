<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>节拍器与调音器</title>
    <link rel="icon" type="image/x-icon" href="photo/icon.ico" />
    <link href="style/style.css" rel="stylesheet" />
  </head>
  <body>
    <!-- 主题控制面板 -->
    <div class="theme-panel collapsed" id="theme-panel">
      <h4 onclick="toggleThemePanel()">
        🎨 主题设置
       <button class="collapse-btn collapsed" id="collapse-btn">▼</button>
      </h4>
      <div class="theme-colors">
        <div
          class="color-option-active"
          style="background: rgb(252, 252, 252)"
          onclick="changeBackground('rgb(252, 252, 252)')"
          title="白色（默认)"
        ></div>
        <div
          class="color-option"
          style="background: rgb(255, 210, 224)"
          onclick="changeBackground('rgb(255, 210, 224)')"
          title="粉色"
        ></div>
        <div
          class="color-option"
          style="background: rgb(173, 216, 230)"
          onclick="changeBackground('rgb(173, 216, 230)')"
          title="淡蓝色"
        ></div>
        <div
          class="color-option"
          style="background: rgb(255, 228, 196)"
          onclick="changeBackground('rgb(255, 228, 196)')"
          title="杏色"
        ></div>
        <div
          class="color-option"
          style="background: rgb(221, 255, 221)"
          onclick="changeBackground('rgb(221, 255, 221)')"
          title="淡绿色"
        ></div>
        <div
          class="color-option"
          style="background: rgb(230, 230, 250)"
          onclick="changeBackground('rgb(230, 230, 250)')"
          title="淡紫色"
        ></div>
      </div>
      <button class="dark-mode-toggle" onclick="toggleDarkMode()">
        🌙 切换夜间模式
      </button>
    </div>

    <div class="audio-status warning" id="audio-status" onclick="initAudio()">
      🔇 点击此处启用音频
    </div>

    <div class="container">
      <div class="tabs">
        <button class="tab active" onclick="switchTab('metronome')">
          🥁 节拍器
        </button>
        <button class="tab" onclick="switchTab('tuner')">🎸 调音器</button>
      </div>

      <!-- 节拍器界面 -->
      <div id="metronome" class="tab-content active">
        <div class="metronome-display">
          <h2>
            节拍器 <span class="status-indicator" id="metronome-status"></span>
          </h2>
          <div class="bpm-display" id="bpm-display">120</div>
          <div style="color: #666; font-size: 18px">BPM</div>

          <div class="beat-indicator" id="beat-indicator">
            <div class="beat-dot"></div>
            <div class="beat-dot"></div>
            <div class="beat-dot"></div>
            <div class="beat-dot"></div>
          </div>

          <!-- 节拍图例 -->
          <div class="legend">
            <div class="legend-item">
              <div class="legend-dot red"></div>
              <span>强拍 (第1拍)</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot yellow"></div>
              <span>次强拍</span>
            </div>
            <div class="legend-item">
              <div class="legend-dot blue"></div>
              <span>弱拍</span>
            </div>
          </div>

          <div style="margin: 20px 0">
            <button
              class="btn btn-primary"
              id="start-stop-btn"
              onclick="toggleMetronome()"
            >
              开始
            </button>
            <button class="btn btn-secondary" onclick="tapTempo()">
              Tap Tempo
            </button>
          </div>
        </div>

        <div class="controls">
          <div class="control-group">
            <label>速度 (BPM): <span id="bpm-value">120</span></label>
            <div class="slider-container">
              <span>40</span>
              <input
                type="range"
                id="bpm-slider"
                min="40"
                max="240"
                value="120"
                oninput="updateBPM(this.value)"
              />
              <span>240</span>
            </div>
          </div>

          <!-- 在 <div class="control-group"> 包含 bpm-slider 的下方添加 -->

          <div class="control-group">
            <label>BPM预设</label>
            <div style="display: flex; gap: 10px; align-items: center">
              <select
                id="bpm-preset-select"
                onchange="loadBPMPreset()"
                style="flex: 1"
              >
                <option value="">-- 选择预设 --</option>
              </select>
              <button
                class="btn btn-secondary"
                onclick="saveBPMPreset()"
                style="padding: 12px 20px"
              >
                保存当前
              </button>
              <button
                class="btn btn-secondary"
                onclick="deleteBPMPreset()"
                style="padding: 12px 20px"
              >
                删除
              </button>
            </div>
          </div>

          <!-- 音量控制 -->
          <div class="control-group">
            <label>音量: <span id="volume-value">70%</span></label>
            <div class="volume-control">
              <div class="volume-display">
                <span class="volume-icon">🔊</span>
                <div class="volume-bars" id="volume-bars">
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                  <div class="volume-bar"></div>
                </div>
              </div>
              <div class="slider-container">
                <input
                  type="range"
                  id="volume-slider"
                  min="0"
                  max="100"
                  value="70"
                  oninput="updateVolume(this.value)"
                />
              </div>
            </div>
          </div>

          <div class="control-group">
            <label>节拍</label>
            <select id="time-signature" onchange="updateTimeSignature()">
              <option value="2/4">2/4</option>
              <option value="3/4">3/4</option>
              <option value="4/4" selected>4/4</option>
              <option value="5/4">5/4</option>
              <option value="6/8">6/8</option>
              <option value="7/8">7/8</option>
              <option value="9/8">9/8</option>
              <option value="12/8">12/8</option>
            </select>
          </div>

          <div class="control-group">
            <label>重音音效</label>
            <select id="accent-sound">
              <option value="woodblock">木块声 Woodblock</option>
              <option value="click">咔哒声 Click</option>
              <option value="cowbell">牛铃 Cowbell</option>
              <option value="snare">小军鼓 Snare</option>
            </select>
          </div>

          <div class="control-group">
            <label>次强拍音效</label>
            <select id="secondary-sound">
              <option value="woodblock">木块声 Woodblock</option>
              <option value="cowbell" selected>牛铃 Cowbell</option>
              <option value="click">咔哒声 Click</option>
              <option value="snare">小军鼓 Snare</option>
            </select>
          </div>

          <div class="control-group">
            <label>普通拍音效</label>
            <select id="regular-sound">
              <option value="click" selected>咔哒声 Click</option>
              <option value="woodblock">木块声 Woodblock</option>
              <option value="hihat">踩镲 Hi-hat</option>
            </select>
          </div>

          <div style="text-align: center; margin-top: 20px">
            <button class="btn btn-secondary" onclick="saveSettings()">
              💾 保存设置
            </button>
            <button class="btn btn-secondary" onclick="loadSettings()">
              📂 加载设置
            </button>
          </div>
        </div>
      </div>

      <!-- 调音器界面 -->
      <div id="tuner" class="tab-content">
        <div class="tuner-display">
          <h2>调音器</h2>

          <!-- 乐器选择 -->
          <div class="instrument-selector">
            <button class="instrument-btn" onclick="selectInstrument('guitar')">
              🎸 吉他
            </button>
            <button class="instrument-btn" onclick="selectInstrument('bass')">
              🎸 贝斯
            </button>
            <button class="instrument-btn" onclick="selectInstrument('piano')">
              🎹 钢琴
            </button>
          </div>

          <!-- 乐器调音区域 -->
          <div id="instrument-tuning-area" style="display: none">
            <!-- 调音模式选择 (吉他/贝斯) -->
            <div class="tuning-modes" id="tuning-modes" style="display: none">
              <!-- 将通过JavaScript动态生成 -->
            </div>

            <!-- 乐器信息 -->
            <div class="instrument-info" id="instrument-info">
              <!-- 将通过JavaScript动态生成 -->
            </div>

            <!-- 琴弦调音卡片 -->
            <div class="string-tuner" id="string-tuner">
              <!-- 将通过JavaScript动态生成 -->
            </div>
          </div>

          <!-- 麦克风输入检测 -->
          <div class="pitch-detector">
            <button
              class="btn btn-primary mic-button"
              id="mic-button"
              onclick="toggleMicrophone()"
            >
              🎤 启动麦克风检测
            </button>

            <div class="tuning-info" id="tuning-info" style="display: none">
              <div class="detected-note" id="detected-note">-</div>
              <div class="cents-display" id="cents-display">0¢</div>
              <div style="color: #666; font-size: 14px">
                <span id="detected-freq">0.00</span> Hz
              </div>
            </div>

            <div class="tuning-gauge" id="tuning-gauge" style="display: none">
              <div class="gauge-background"></div>
              <div class="gauge-center"></div>
              <div class="gauge-needle" id="gauge-needle"></div>
            </div>

            <canvas
              class="waveform-display"
              id="waveform-canvas"
              style="display: none"
            ></canvas>

            <div
              style="
                text-align: center;
                margin-top: 20px;
                color: #666;
                font-size: 14px;
              "
            >
              <div id="tuner-status">点击上方按钮开始检测乐器音高</div>
            </div>
          </div>

          <hr
            style="margin: 30px 0; border: none; border-top: 1px solid #ddd"
          />

          <!-- 参考音播放 -->
          <h3 style="text-align: center; margin: 20px 0">参考音播放</h3>

          <div class="keyboard-controls">
            <div class="octave-selector">
              <span style="font-weight: 600">选择八度:</span>
              <button class="octave-btn" onclick="changeOctave(3)">
                C3-B3
              </button>
              <button class="octave-btn active" onclick="changeOctave(4)">
                C4-B4
              </button>
              <button class="octave-btn" onclick="changeOctave(5)">
                C5-B5
              </button>
            </div>
          </div>

          <div class="octave-label" id="octave-label">中央C (C4) 八度</div>

          <div class="piano-keyboard" id="piano-keyboard">
            <!-- 将通过JavaScript动态生成 -->
          </div>

          <div style="text-align: center; margin: 20px 0">
            <button class="btn btn-primary" onclick="playChromatic()">
              播放当前八度半音阶
            </button>
            <button class="btn btn-secondary" onclick="playMajorScale()">
              播放C大调音阶
            </button>
          </div>
        </div>

        <div class="note-buttons" style="display: none">
          <button class="note-btn" onclick="playNote('C4', 261.63)">C4</button>
          <button class="note-btn black-key" onclick="playNote('C#4', 277.18)">
            C#4
          </button>
          <button class="note-btn" onclick="playNote('D4', 293.66)">D4</button>
          <button class="note-btn black-key" onclick="playNote('D#4', 311.13)">
            D#4
          </button>
          <button class="note-btn" onclick="playNote('E4', 329.63)">E4</button>
          <button class="note-btn" onclick="playNote('F4', 349.23)">F4</button>
          <button class="note-btn black-key" onclick="playNote('F#4', 369.99)">
            F#4
          </button>
          <button class="note-btn" onclick="playNote('G4', 392.00)">G4</button>
          <button class="note-btn black-key" onclick="playNote('G#4', 415.30)">
            G#4
          </button>
          <button class="note-btn" onclick="playNote('A4', 440.00)">A4</button>
          <button class="note-btn black-key" onclick="playNote('A#4', 466.16)">
            A#4
          </button>
          <button class="note-btn" onclick="playNote('B4', 493.88)">B4</button>
        </div>

        <div style="text-align: center; margin: 30px 0">
          <button class="btn btn-primary" onclick="playChromatic()">
            播放半音阶
          </button>
        </div>
      </div>
    </div>

    <!-- 作者信息面板 -->
    <div class="info-panel" id="info-panel">
      <div class="info-header" onclick="toggleInfoPanel()">
        <span>ℹ About</span>
        <button class="info-collapse-btn" id="info-collapse-btn">◀</button>
      </div>
      <div class="info-content" id="info-content">
        <div class="info-section">
          <h4>节拍器与调音器</h4>
          <p class="version">ver 0.0.1</p>
        </div>

        <div class="info-section">
          <h4>Author(✪ω✪)</h4>
          <p><strong>Lilywhite&Haru</strong></p>
          <div class="author-avatar">
            <img src="photo/head.png" alt="作者头像" id="author-image" />
          </div>

          <p>Contact： 大喊作者的名字三声</p>
        </div>

        <div class="info-section">
          <h4>Functions & Features</h4>
          <ul>
            <li><del>一点也不</del><strong>精准节拍器</strong></li>
            <li>实时调音检测</li>
            <li>钢琴参考音</li>
            <li>乐器调音模式(尝试实现ing)</li>
          </ul>
        </div>

        <div class="info-section">
          <h4>How to Use</h4>
          <p class="small-text">没有写哦~</p>
        </div>

        <div class="info-section">
          <h4>Technology Stack</h4>
          <p class="small-text">Web Audio API / HTML5 / CSS3 / JavaScript</p>
        </div>

        <div class="info-footer">
          <p>© 2026 没有版权 ， 随便乱用 <del>(因为太烂惹)</del></p>
          <p class="small-text">
            Made with Lilywhite and ClaudeSama(˘•ω•˘) for MusLovers!
          </p>
        </div>
      </div>
    </div>

    <script src="script/main.js" defer></script>
  </body>
</html>
